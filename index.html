<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#1a1a1a">
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="css/styles.css">
<title>Zaman Etüdü</title>
</head>
<body>

<!-- MAIN MENU -->
<div id="menuScreen" class="screen visible">
  <div class="menu-logo"><svg viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/></svg></div>
  <div class="menu-title">Zaman Etüdü</div>
  <div class="menu-sub">Saha Kronometresi</div>
  <div class="menu-btns">
    <button class="menu-btn menu-btn-primary" id="goMeasure"><svg viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z"/></svg>Zaman Tut</button>
    <button class="menu-btn menu-btn-secondary" id="goTags"><svg viewBox="0 0 24 24"><path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/></svg>Etiketleri Düzenle</button>
    <button class="menu-btn menu-btn-secondary" id="goHistory"><svg viewBox="0 0 24 24"><path d="M13 3a9 9 0 00-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0013 21a9 9 0 000-18zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>Geçmiş Veriler</button>
  </div>
</div>

<!-- MODE SELECT -->
<div id="modeSelectScreen" class="screen hidden">
  <div class="mode-title">Ölçüm Modu Seçin</div>
  <div class="mode-sub">Yapmak istediğiniz zaman etüdü türüne göre bir mod seçin</div>
  <div class="mode-cards">
    <div class="mode-card" id="modeRepeat">
      <div class="mode-card-icon"><svg viewBox="0 0 24 24"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46A7.93 7.93 0 0020 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74A7.93 7.93 0 004 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg></div>
      <h3>Tekrarlı Ölçüm</h3>
      <p>Aynı işlem tekrar tekrar yapılır ve her tekrar ölçülür. Ortalama süre, standart sapma ve gerekli gözlem sayısı hesaplanır.</p>
    </div>
    <div class="mode-card" id="modeSequence">
      <div class="mode-card-icon mode-seq"><svg viewBox="0 0 24 24"><path d="M3 5h2v14H3V5zm4 0h2v14H7V5zm4 0h2v14h-2V5zm4 0h2v14h-2V5zm4 0h2v14h-2V5z"/></svg></div>
      <h3>Ardışık İşlem</h3>
      <p>Birbirini takip eden farklı iş adımları sırasıyla ölçülür. Her adım için ayrı istatistikler hesaplanır.</p>
    </div>
  </div>
  <button class="mode-back" id="modeBack">Geri Dön</button>
</div>

<!-- SETUP -->
<div id="setupScreen" class="screen hidden">
  <form class="setup-form" id="setupForm" style="margin:auto">
    <div class="setup-title" id="setupTitle">Yeni Ölçüm</div>
    <div class="setup-mode-hint" id="setupModeHint" style="font-size:clamp(10px,3vw,13px);color:var(--tx2);text-align:center;margin-bottom:clamp(8px,2vh,16px);line-height:1.5"></div>
    <div class="inp-grp"><label>Operatör Adı</label><input type="text" id="inpOp" placeholder="İşi yapan kişinin adını girin" autocomplete="off" required></div>
    <div class="inp-grp"><label>İş / Proses Adı</label><input type="text" id="inpJob" placeholder="İş tanımını girin" autocomplete="off" required></div>
    <div id="setupStepsPreview" style="display:none;margin:clamp(8px,2vh,12px) 0"></div>
    <button type="submit" class="btn-go">BAŞLAT</button>
    <button type="button" class="btn-back" id="setupBack">Geri Dön</button>
  </form>
</div>

<!-- TAG EDITOR -->
<div id="tagEditorScreen" class="screen hidden">
  <div class="te-header">
    <button class="te-back" id="teBack"><svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg></button>
    <h2>Etiketleri Düzenle</h2>
  </div>
  <div id="teList"></div>
  <button class="te-save" id="teSave">KAYDET</button>
</div>

<!-- HISTORY -->
<div id="historyScreen" class="screen hidden">
  <div class="hi-header">
    <button class="te-back" id="hiBack"><svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg></button>
    <h2>Geçmiş Veriler</h2>
  </div>
  <div id="hiList"></div>
</div>

<!-- MEASUREMENT -->
<div id="measureScreen" class="screen hidden">
  <div class="top-bar">
    <div class="top-bar-info"><div class="job-name" id="dJob">—</div><div class="op-name" id="dOp">—</div></div>
    <div class="top-bar-acts">
      <button class="btn-ic" id="bNote" title="Not (N)"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h5v7h7v9H6zm2-7h8v2H8v-2zm0 4h5v2H8v-2z"/></svg></button>
      <button class="btn-ic danger" id="bStop" title="Bitir (Q)"><svg viewBox="0 0 24 24"><path d="M6 6h12v12H6z"/></svg></button>
    </div>
  </div>
  <div class="tag-strip" id="tagStrip"></div>
  <div class="step-indicator" id="stepIndicator">
    <div class="step-top-row">
      <div class="step-current">
        <div class="step-num" id="stepNum">1</div>
        <div class="step-name-wrap">
          <span class="step-name-label">Şu anki adım</span>
          <span class="step-name" id="stepName" title="Düzenlemek için tıkla">—</span>
        </div>
      </div>
      <div class="step-cycle" id="stepCycle">Çevrim 1</div>
    </div>
    <div class="step-dots" id="stepDots"></div>
  </div>
  <div class="timer-area" id="timerArea">
    <div class="timer-tempo-wrap">
      <div class="timer-ring">
        <svg class="timer-ring-svg" viewBox="0 0 200 200"><circle class="ring-bg" cx="100" cy="100" r="90"/><circle class="ring-prog" id="ringProg" cx="100" cy="100" r="90"/></svg>
        <div class="timer-display">
          <div class="timer-time" id="tTime">00:00</div>
          <div class="timer-ms" id="tMs">.00</div>
          <div class="timer-st" id="tState">Başlamak için dokun</div>
        </div>
      </div>
      <div class="tempo-picker" id="tempoPicker">
        <div class="tempo-picker-label">Tempo %</div>
        <div class="tempo-wheel" id="tempoWheel">
          <div class="tempo-items" id="tempoItems"></div>
        </div>
      </div>
    </div>
    <div class="tap-hint" id="tapHint">Ekrana dokun = Tur kaydet</div>
    <div class="lap-ctr" id="lapCtr" style="display:none"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/></svg><span class="cnt" id="lapN">0</span> tur</div>
  </div>
  <div class="lap-wrap" id="lapWrap"><div class="lap-list" id="lapList"></div></div>
  <div class="kb-bar">
    <span><kbd>Space</kbd> Tur</span>
    <span><kbd>1</kbd><kbd>2</kbd><kbd>3</kbd><kbd>4</kbd> Etiketli tur</span>
    <span><kbd>+</kbd><kbd>−</kbd> Tempo</span>
    <span><kbd>P</kbd> Duraklat</span>
    <span><kbd>N</kbd> Not</span>
    <span><kbd>Q</kbd> Bitir</span>
    <span><kbd>Sağ tık</kbd> Etiketle</span>
  </div>
</div>

<!-- SUMMARY -->
<div id="summaryScreen" class="screen hidden"></div>

<!-- NOTE PANEL -->
<div class="overlay" id="noteOv"></div>
<div class="panel" id="notePanel">
  <div class="panel-handle"></div>
  <div class="panel-title">Not Ekle</div>
  <div class="note-chips" id="noteChips"></div>
  <textarea class="note-ta" id="noteTa" placeholder="Notunuzu yazın..."></textarea>
  <button class="note-save" id="noteSave">KAYDET</button>
</div>

<!-- TAG PICKER -->
<div class="overlay" id="tpOv"></div>
<div class="panel" id="tpPanel" style="max-width:420px;left:50%;right:auto;transform:translateX(-50%) translateY(100%)">
  <div class="panel-handle"></div>
  <div class="panel-title" id="tpTitle">Etiket Seç</div>
  <div class="tp-grid" id="tpGrid"></div>
</div>

<!-- STEP NAME EDIT PANEL -->
<div class="overlay" id="stepOv"></div>
<div class="panel" id="stepPanel" style="max-width:340px;left:50%;right:auto;transform:translateX(-50%) translateY(100%)">
  <div class="panel-handle"></div>
  <div class="panel-title" id="stepPanelTitle">Adım Adını Düzenle</div>
  <div class="inp-grp" style="margin-bottom:12px">
    <label>Adım Adı</label>
    <input type="text" id="stepNameInput" placeholder="Adım adını girin" maxlength="30">
  </div>
  <button class="te-save-btn" id="stepSaveBtn">KAYDET</button>
</div>

<!-- TEMPO EDIT PANEL -->
<div class="overlay" id="teOv"></div>
<div class="panel" id="tePanel" style="max-width:320px;left:50%;right:auto;transform:translateX(-50%) translateY(100%)">
  <div class="panel-handle"></div>
  <div class="panel-title" id="teTitle">Tempo Düzenle</div>
  <div class="te-tempo-wrap">
    <button class="te-tempo-btn" id="teMinus">−</button>
    <input type="number" class="te-tempo-input" id="teInput" min="50" max="150" step="5" value="100">
    <button class="te-tempo-btn" id="tePlus">+</button>
  </div>
  <div class="te-presets">
    <button class="te-preset" data-val="75">75</button>
    <button class="te-preset" data-val="100">100</button>
    <button class="te-preset" data-val="125">125</button>
  </div>
  <button class="te-save-btn" id="teSaveBtn">KAYDET</button>
</div>

<!-- TOAST -->
<div class="toast-c" id="toastC"></div>
<input type="file" id="jsonImportInput" accept=".json" style="display:none">

<!-- DT overlay -->
<div class="dt-ov" id="dtOv"><div class="dt-ico" id="dtIco"></div></div>

<!-- FINISH MODAL -->
<div class="modal-ov" id="finModal">
  <div class="modal-box">
    <div class="modal-t">Ölçümü Bitir</div>
    <div class="modal-p">Tüm tur verileri kaydedilecek ve özet gösterilecek. Devam etmek istiyor musunuz?</div>
    <div class="modal-acts">
      <button class="modal-btn m-cancel" id="mCancel">Vazgeç</button>
      <button class="modal-btn m-confirm" id="mConfirm">Bitir</button>
    </div>
  </div>
</div>

<!-- SUMMARY DELETE MODAL -->
<div class="modal-ov" id="sumDelModal">
  <div class="modal-box">
    <div class="modal-t">Turu Sil</div>
    <div class="modal-p">Bu turu silmek istediğinizden emin misiniz? Kümülatif süreler ve tur numaraları yeniden hesaplanacak.</div>
    <div class="modal-acts">
      <button class="modal-btn m-cancel" id="sdCancel">Vazgeç</button>
      <button class="modal-btn m-confirm" id="sdConfirm">Sil</button>
    </div>
  </div>
</div>

<!-- HISTORY DELETE MODAL -->
<div class="modal-ov" id="hiDelModal">
  <div class="modal-box">
    <div class="modal-t">Ölçümü Sil</div>
    <div class="modal-p">Bu ölçüm kaydını silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.</div>
    <div class="modal-acts">
      <button class="modal-btn m-cancel" id="hdCancel">Vazgeç</button>
      <button class="modal-btn m-confirm" id="hdConfirm">Sil</button>
    </div>
  </div>
</div>

<script type="module" src="js/main.js"></script>
</body>
</html>
